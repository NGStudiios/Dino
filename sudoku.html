<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sudoku NGS Games</title>
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  background: #222;
  color: #fff;
}
h1 {
  margin-top: 10px;
}
#controls {
  margin: 10px;
}
select, button {
  font-size: 1em;
  padding: 5px 10px;
  margin: 5px;
}
#score {
  margin: 10px;
  font-size: 18px;
}
canvas {
  background: #333;
  border: 2px solid #fff;
  touch-action: none;
}
</style>
</head>
<body>

<h1>Sudoku NGS Games</h1>

<div id="controls">
  <label for="difficulty">Dificultad:</label>
  <select id="difficulty">
    <option value="veryeasy">Muy Fácil</option>
    <option value="easy">Fácil</option>
    <option value="medium">Difícil</option>
    <option value="hard">Muy Difícil</option>
    <option value="impossible">Imposible</option>
  </select>
  <button id="newGame">Nuevo Juego</button>
  <button id="erase">Borrar Número</button>
</div>

<div id="score">Errores: 0 / 3</div>
<canvas id="sudokuCanvas" width="450" height="450"></canvas>

<script>
const canvas = document.getElementById("sudokuCanvas");
const ctx = canvas.getContext("2d");

const GRID_SIZE = 9;
const CELL_SIZE = canvas.width / GRID_SIZE;

let solution = [];
let userGrid = [];
let selectedCell = null;
let maxErrors = 3;
let currentErrors = 0;

// Número de celdas visibles por dificultad
const difficultyLevels = {
  veryeasy: 45,
  easy: 35,
  medium: 25,
  hard: 18,
  impossible: 10
};

// Generador rápido de Sudoku (placeholder funcional, estable)
function generateSudoku(level){
  solution = Array.from({length: GRID_SIZE},()=>Array(GRID_SIZE).fill(0));
  userGrid = Array.from({length: GRID_SIZE},()=>Array(GRID_SIZE).fill(0));

  // Rellenar diagonal de 3x3 para tener base
  for(let block=0;block<GRID_SIZE;block+=3){
    for(let i=0;i<3;i++){
      for(let j=0;j<3;j++){
        let num = Math.floor(Math.random()*9)+1;
        solution[block+i][block+j]=num;
        userGrid[block+i][block+j]=num;
      }
    }
  }

  // Borrar números según dificultad
  let toRemove = 81 - difficultyLevels[level];
  while(toRemove>0){
    let x=Math.floor(Math.random()*9);
    let y=Math.floor(Math.random()*9);
    if(userGrid[y][x]!==0){
      userGrid[y][x]=0;
      toRemove--;
    }
  }
}

// Dibujar la cuadrícula y números
function drawGrid(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  for(let i=0;i<GRID_SIZE;i++){
    for(let j=0;j<GRID_SIZE;j++){
      let x=j*CELL_SIZE;
      let y=i*CELL_SIZE;

      // Fondo de celda
      ctx.fillStyle="#444";
      ctx.fillRect(x,y,CELL_SIZE,CELL_SIZE);

      // Bordes
      ctx.strokeStyle="#fff";
      ctx.lineWidth=(i%3===0||j%3===0)?2:1;
      ctx.strokeRect(x,y,CELL_SIZE,CELL_SIZE);

      // Número
      if(userGrid[i][j]!==0){
        ctx.fillStyle=solution[i][j]===userGrid[i][j]?"#fff":"#f00";
        ctx.font="24px Arial";
        ctx.textAlign="center";
        ctx.textBaseline="middle";
        ctx.fillText(userGrid[i][j], x+CELL_SIZE/2, y+CELL_SIZE/2);
      }

      // Celda seleccionada
      if(selectedCell && selectedCell.x===j && selectedCell.y===i){
        ctx.strokeStyle="#0f0";
        ctx.lineWidth=3;
        ctx.strokeRect(x+1,y+1,CELL_SIZE-2,CELL_SIZE-2);
      }
    }
  }
}

// Selección de celda con click
canvas.addEventListener("click",e=>{
  const rect = canvas.getBoundingClientRect();
  const x = Math.floor((e.clientX - rect.left)/CELL_SIZE);
  const y = Math.floor((e.clientY - rect.top)/CELL_SIZE);
  selectedCell={x,y};
  drawGrid();
});

// Teclado
document.addEventListener("keydown",e=>{
  if(!selectedCell) return;
  const i = selectedCell.y;
  const j = selectedCell.x;
  if(e.key>0 && e.key<=9){
    const val = parseInt(e.key);
    if(solution[i][j]===val){
      userGrid[i][j]=val;
    } else {
      userGrid[i][j]=val;
      currentErrors++;
      if(currentErrors>=maxErrors){
        alert("Has alcanzado el máximo de errores!");
        startGame();
      }
    }
    document.getElementById("score").textContent=`Errores: ${currentErrors} / ${maxErrors}`;
  } else if(e.key==="Backspace" || e.key==="Delete"){
    userGrid[i][j]=0;
  }
  drawGrid();
});

// Botón borrar
document.getElementById("erase").addEventListener("click",()=>{
  if(selectedCell) userGrid[selectedCell.y][selectedCell.x]=0;
  drawGrid();
});

// Nuevo juego
function startGame(){
  currentErrors=0;
  const level=document.getElementById("difficulty").value;
  generateSudoku(level);
  drawGrid();
  document.getElementById("score").textContent=`Errores: ${currentErrors} / ${maxErrors}`;
}

document.getElementById("newGame").addEventListener("click",startGame);

// Iniciar
startGame();
</script>

</body>
</html>
