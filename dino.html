<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dinosaurio Prácticamente - Mejorado</title>
<style>
body {
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:#87CEEB; /* cielo celeste */
  overflow:hidden;
}
canvas {
  display:block;
  margin:0 auto;
  background:#87CEEB;
  border:3px solid #00e5ff;
}
.scoreboard {
  text-align:center;
  color:#fff;
  text-shadow:0 0 5px #000;
  font-size:1.5em;
  margin:5px 0;
}
button {
  position:fixed;
  bottom:20px;
  width:80px;
  height:50px;
  font-size:1.2em;
  border:none;
  border-radius:10px;
  background:#00e5ff;
  color:#111;
  z-index:10;
}
#jumpBtn { left:20px; }
#duckBtn { right:20px; }
</style>
</head>
<body>
<div class="scoreboard">
  Puntaje: <span id="score">0</span> | Récord: <span id="record">0</span>
</div>
<canvas id="gameCanvas" width="1000" height="300"></canvas>
<button id="jumpBtn">↑ Saltar</button>
<button id="duckBtn">↓ Agachar</button>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let score = 0;
let record = localStorage.getItem('dinoRecord') || 0;
let speed = 6;
let frame = 0;

// Dino
const dino = {
  x: 50,
  y: 200,
  width: 80,
  height: 80,
  velocityY: 0,
  gravity: 1.2,
  jump: -20,
  onGround: true,
  ducking: false,
  image: new Image()
};
dino.image.src = 'dino.png';

// Obstáculos (cactus)
let obstacles = [];
const cactusImage = new Image();
cactusImage.src = 'captus.png';

// Meteoritos
let meteors = [];
const meteorImage = new Image();
meteorImage.src = 'meteor.png';

// Nubes
let clouds = [];
for(let i=0;i<5;i++){
  clouds.push({x: Math.random()*canvas.width, y: Math.random()*50, width:100, height:50});
}

const scoreEl = document.getElementById('score');
const recordEl = document.getElementById('record');
recordEl.innerText = record;

function spawnObstacle() {
  const height = 60; // cactus más grande
  obstacles.push({
    x: canvas.width,
    y: canvas.height - height - 40,
    width: 40,
    height: height,
    image: cactusImage
  });
}

function spawnMeteor() {
  const size = 40 + Math.random()*40;
  meteors.push({
    x: Math.random()*(canvas.width-50),
    y: -size,
    width: size,
    height: size,
    image: meteorImage,
    velocityY: 6 + Math.random()*3
  });
}

function drawDino() {
  if(dino.ducking){
    ctx.drawImage(dino.image, dino.x, dino.y + dino.height/2, dino.width, dino.height/2);
  } else {
    ctx.drawImage(dino.image, dino.x, dino.y, dino.width, dino.height);
  }
}

function drawObstacles() {
  obstacles.forEach(obs => ctx.drawImage(obs.image, obs.x, obs.y, obs.width, obs.height));
}

function drawMeteors() {
  meteors.forEach(m => ctx.drawImage(m.image, m.x, m.y, m.width, m.height));
}

function drawClouds() {
  ctx.fillStyle = '#fff';
  clouds.forEach(c => {
    ctx.beginPath();
    ctx.ellipse(c.x, c.y, c.width, c.height, 0,0,2*Math.PI);
    ctx.fill();
    c.x -= 0.5; // mover nube lentamente
    if(c.x + c.width <0) c.x = canvas.width;
  });
}

function updateObstacles() {
  if(frame % 120 === 0) spawnObstacle();
  obstacles.forEach(obs => obs.x -= speed);
  obstacles = obstacles.filter(obs => obs.x + obs.width > 0);
}

function updateMeteors() {
  if(frame % 200 === 0) spawnMeteor();
  meteors.forEach(m => m.y += m.velocityY);
  meteors = meteors.filter(m => m.y < canvas.height);
}

function checkCollisions() {
  obstacles.forEach(obs => {
    if(dino.x < obs.x + obs.width &&
       dino.x + dino.width > obs.x &&
       dino.y < obs.y + obs.height &&
       dino.y + dino.height > obs.y){
      resetGame();
    }
  });
  meteors.forEach(m => {
    if(dino.x < m.x + m.width &&
       dino.x + dino.width > m.x &&
       dino.y < m.y + m.height &&
       dino.y + dino.height > m.y){
      resetGame();
    }
  });
}

function updateScore() {
  score += 0.2;
  scoreEl.innerText = Math.floor(score);
  if(score > record){
    record = Math.floor(score);
    recordEl.innerText = record;
    localStorage.setItem('dinoRecord', record);
  }
  speed = 6 + Math.floor(score/100);
}

function resetGame() {
  dino.y = 200;
  dino.velocityY = 0;
  dino.ducking = false;
  dino.onGround = true;
  obstacles = [];
  meteors = [];
  frame = 0;
  score = 0;
  speed = 6;
  scoreEl.innerText = score;
}

function update() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // fondo
  ctx.fillStyle = '#87CEEB';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  drawClouds();

  // suelo marrón
  ctx.fillStyle = '#8B4513';
  ctx.fillRect(0, canvas.height - 40, canvas.width, 40);

  drawDino();
  drawObstacles();
  drawMeteors();
  updateObstacles();
  updateMeteors();
  checkCollisions();
  updateScore();

  // física Dino
  if(!dino.ducking){
    dino.velocityY += dino.gravity;
    dino.y += dino.velocityY;
    if(dino.y + dino.height >= canvas.height - 40){
      dino.y = canvas.height - 40 - dino.height;
      dino.velocityY = 0;
      dino.onGround = true;
    } else {
      dino.onGround = false;
    }
  }

  frame++;
  requestAnimationFrame(update);
}

// controles
function jump() {
  if(dino.onGround && !dino.ducking){
    dino.velocityY = dino.jump;
  }
}
function duck(state){
  dino.ducking = state;
}

document.addEventListener('keydown', e => {
  if(e.code === 'Space') jump();
  if(e.code === 'ArrowDown') duck(true);
});
document.addEventListener('keyup', e => {
  if(e.code === 'ArrowDown') duck(false);
});
canvas.addEventListener('touchstart', jump);
document.getElementById('jumpBtn').addEventListener('touchstart', jump);
document.getElementById('duckBtn').addEventListener('touchstart', ()=>duck(true));
document.getElementById('duckBtn').addEventListener('touchend', ()=>duck(false));

update();
</script>
</body>
</html>
