<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tetris Competitivo - Móvil</title>
<style>
  body {
    margin: 0;
    background: #111;
    font-family: 'Segoe UI', sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    color: #fff;
    touch-action: none;
  }

  h1 {
    text-align: center;
    font-size: 1.8em;
    color: #00e5ff;
    text-shadow: 0 0 5px #00e5ff, 0 0 10px #00e5ff;
    margin-bottom: 10px;
  }

  .tetris-container {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  canvas {
    background: #222;
    border: 3px solid #fff;
    image-rendering: pixelated;
    touch-action: none;
  }

  .info {
    display: flex;
    justify-content: space-around;
    width: 100%;
    margin-top: 10px;
    font-size: 1em;
  }

  .controls {
    display: flex;
    justify-content: center;
    margin-top: 15px;
    gap: 10px;
    flex-wrap: wrap;
  }

  .controls button {
    padding: 15px;
    font-size: 1.2em;
    background: #00e5ff;
    border: none;
    border-radius: 5px;
    color: #111;
    cursor: pointer;
    min-width: 60px;
    transition: 0.2s;
    touch-action: manipulation;
  }

  .controls button:hover {
    background: #00b3cc;
  }
</style>
</head>
<body>
<h1>TETRIS COMPETITIVO</h1>
<div class="tetris-container">
  <canvas id="tetris" width="240" height="480"></canvas>
  <div class="info">
    <div>Puntaje: <span id="score">0</span></div>
    <div>Líneas: <span id="lines">0</span></div>
    <div>Nivel: <span id="level">0</span></div>
  </div>
  <div class="controls">
    <button id="left">←</button>
    <button id="rotate">⟳</button>
    <button id="right">→</button>
    <button id="down">↓</button>
    <button id="restart">Reiniciar</button>
  </div>
</div>

<script>
const canvas = document.getElementById('tetris');
const context = canvas.getContext('2d');
context.scale(24, 24);

const scoreElement = document.getElementById('score');
const linesElement = document.getElementById('lines');
const levelElement = document.getElementById('level');

const arenaWidth = 10;
const arenaHeight = 20;

function createMatrix(w, h) {
  const matrix = [];
  while (h--) matrix.push(new Array(w).fill(0));
  return matrix;
}

function createPiece(type) {
  if (type === 'T') return [[0,0,0],[1,1,1],[0,1,0]];
  if (type === 'O') return [[2,2],[2,2]];
  if (type === 'L') return [[0,0,3],[3,3,3],[0,0,0]];
  if (type === 'J') return [[4,0,0],[4,4,4],[0,0,0]];
  if (type === 'I') return [[0,5,0,0],[0,5,0,0],[0,5,0,0],[0,5,0,0]];
  if (type === 'S') return [[0,6,6],[6,6,0],[0,0,0]];
  if (type === 'Z') return [[7,7,0],[0,7,7],[0,0,0]];
}

function merge(arena, player) {
  player.matrix.forEach((row, y) => row.forEach((value, x) => {
    if(value !== 0) arena[y + player.pos.y][x + player.pos.x] = value;
  }));
}

function collide(arena, player) {
  const m = player.matrix;
  const o = player.pos;
  for (let y=0; y<m.length; y++) {
    for (let x=0; x<m[y].length; x++) {
      if (m[y][x] !== 0 && (arena[y+o.y] && arena[y+o.y][x+o.x]) !== 0) return true;
    }
  }
  return false;
}

function rotate(matrix, dir) {
  for (let y=0; y<matrix.length; y++)
    for (let x=0; x<y; x++)
      [matrix[x][y], matrix[y][x]] = [matrix[y][x], matrix[x][y]];
  if(dir > 0) matrix.forEach(row => row.reverse());
  else matrix.reverse();
}

function arenaSweep() {
  let rowCount = 0;
  outer: for(let y=arena.length-1; y>=0; y--) {
    for(let x=0; x<arena[y].length; x++)
      if(arena[y][x] === 0) continue outer;
    const row = arena.splice(y,1)[0].fill(0);
    arena.unshift(row);
    rowCount++;
    y++;
  }
  if(rowCount > 0) {
    player.score += rowCount * 10 * rowCount;
    player.lines += rowCount;
    player.level = Math.floor(player.lines/10);
  }
}

function drawMatrix(matrix, offset) {
  const colors = [null,'#ff0d72','#0dc2ff','#0dff72','#f538ff','#ff8e0d','#ffe138','#3877ff'];
  matrix.forEach((row,y) => row.forEach((value,x) => {
    if(value !== 0){
      context.fillStyle = colors[value];
      context.fillRect(x+offset.x,y+offset.y,1,1);
      context.strokeStyle = '#000';
      context.lineWidth = 0.05;
      context.strokeRect(x+offset.x,y+offset.y,1,1);
    }
  }));
}

function draw() {
  context.fillStyle = '#222';
  context.fillRect(0,0,canvas.width,canvas.height);
  drawMatrix(arena, {x:0,y:0});
  drawMatrix(player.matrix, player.pos);
}

function playerDrop() {
  player.pos.y++;
  if(collide(arena,player)){
    player.pos.y--;
    merge(arena,player);
    arenaSweep();
    updateScore();
    playerReset();
    if(collide(arena,player)) arena.forEach(row=>row.fill(0)),player.score=0,player.lines=0,player.level=0,updateScore();
  }
  dropCounter=0;
}

function playerMove(dir) {player.pos.x+=dir;if(collide(arena,player))player.pos.x-=dir;}
function playerRotate(dir){
  const pos = player.pos.x;
  rotate(player.matrix,dir);
  let offset=1;
  while(collide(arena,player)){player.pos.x+=offset;offset=-(offset+(offset>0?1:-1));if(offset>player.matrix[0].length){rotate(player.matrix,-dir);player.pos.x=pos;return;}}
}
function playerReset(){const pieces='TJLOSZI';player.matrix=createPiece(pieces[Math.floor(Math.random()*pieces.length)]);player.pos.y=0;player.pos.x=(arena[0].length/2|0)-(player.matrix[0].length/2|0);}
function update(time=0){const deltaTime=time-lastTime;lastTime=time;dropCounter+=deltaTime;if(dropCounter>dropInterval-player.level*50)playerDrop();draw();requestAnimationFrame(update);}
function updateScore(){scoreElement.innerText=player.score;linesElement.innerText=player.lines;levelElement.innerText=player.level;}

const arena=createMatrix(arenaWidth,arenaHeight);
const player={pos:{x:0,y:0},matrix:null,score:0,lines:0,level:0};
let dropCounter=0,dropInterval=1000,lastTime=0;

document.addEventListener('keydown',e=>{
  if(e.keyCode===37)playerMove(-1);
  else if(e.keyCode===39)playerMove(1);
  else if(e.keyCode===40)playerDrop();
  else if(e.keyCode===81)playerRotate(-1);
  else if(e.keyCode===87)playerRotate(1);
});

// Botones táctiles
document.getElementById('left').addEventListener('touchstart',()=>playerMove(-1));
document.getElementById('right').addEventListener('touchstart',()=>playerMove(1));
document.getElementById('down').addEventListener('touchstart',()=>playerDrop());
document.getElementById('rotate').addEventListener('touchstart',()=>playerRotate(1));
document.getElementById('restart').addEventListener('touchstart',()=>{
  arena.forEach(row=>row.fill(0));
  player.score=0;player.lines=0;player.level=0;
  playerReset();updateScore();
});

playerReset();
updateScore();
update();
</script>
</body>
</html>
